# Архитектура LAppka

## Обзор

Модульная система учебной аналитики для Moodle: сопоставление HTML-статистики с GIFT-банком вопросов, категоризация, расчёт KBTB, рекомендации экспертной системы, Person-Item Map.

## Структура проекта

```
LAppka/
├── app_new.py              # Главный файл
├── config/
│   └── settings.py         # Настройки, список модулей
├── modules/
│   ├── base/               # Базовый слой
│   │   ├── data_loader.py  # Загрузка HTML/CSV
│   │   ├── data_parser.py  # Парсинг и структурирование
│   │   └── html_parser.py  # Парсинг HTML Moodle
│   ├── question_analysis/  # Модуль 1: Анализ вопросов
│   ├── irt_analysis/       # Модуль 2: Person-Item Map
│   ├── expert_system/      # Модуль 3: KBTB, рекомендации
│   └── categorization/    # Модуль 4: Категоризация, GIFT
├── utils/
└── docs/
```

## Принципы

- **Модульность**: каждый модуль — отдельная функциональность
- **Разделение ответственности**: base — парсинг; модули — анализ, визуализация, экспорт
- **Единый источник данных**: HTML + GIFT загружаются один раз, используются во всех модулях

## Модули

| Модуль | Функции |
|--------|---------|
| **base** | Парсинг HTML (BeautifulSoup), загрузка, парсинг CSV (legacy) |
| **question_analysis** | Таблица вопросов, метрики, цветовое кодирование по сложности |
| **irt_analysis** | Person-Item Map в логит-шкале, коэффициент перекрытия |
| **expert_system** | KBTB, целевые доли L/M/H (связанные слайдеры), рекомендации с количеством |
| **categorization** | Сопоставление с GIFT, категории, экспорт в GIFT с суффиксом (Lappka) |

## Поток данных

1. HTML-отчёт → `html_parser` / `data_loader` → структурированные данные вопросов
2. GIFT → `moodle_parser` → список вопросов банка
3. Сопоставление (SequenceMatcher) → обогащённые данные
4. Категоризация → L/M/H, O/Z, «на переделку»
5. KBTB, рекомендации, визуализация

## Добавление модуля

1. Создать `modules/<name>/` с `__init__.py`, `module.py`
2. В `module.py` реализовать `def render():`
3. Добавить в `config/settings.py` (MODULES)
4. Импортировать и добавить в `app_new.py` (tab_functions)
